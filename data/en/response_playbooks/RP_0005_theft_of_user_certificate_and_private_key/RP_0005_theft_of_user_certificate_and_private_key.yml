title: Theft of user certificate and private key
description: Response playbook for "Theft of user certificate and private key" attack
id: RP0005
author: '@ERMACK_COMMUNITY'
creation_date: 2023/05/31
modification_date: 2023/05/31
linked_artifacts:
  - A1001
  - A1005
  - A1011
tags:
  - status.stable
  - severity.high
  - windows
preparation:
  - RP_1001_operational_preparations
  - RA_1602_get_ability_to_lock_user_account
identification:
  - RP_1002_identify_affected_systems_and_users
containment:
  - RP_0009_compromised_active_directory_account
  - RP_0008_windows_host_compromise
eradication:
  - RA_4605_revoke_certificate
recovery:
  - RA_5602_reissue_revoked_certificate
lessons_learned:
  - RA_6001_develop_incident_report
  - RA_6002_conduct_lessons_learned_exercise

#ToDo: create workflow
extended_description: |
  Attackers can theft certificate and private key to authenticate on behalf of the certificate owner using Public Key Cryptography for Initial Authentication (PKINIT) Kerberos extension. Successful "Theft of user certificate and private key" attack quite dangerous, because attackers gets credentials alternative to the password
workflow: |
    <img src="../RP0005.png" alt="WORKFLOW"/>
  
    1. On identification stage need find <[domain account]>(A_1001) whose certificate were theft and <[host]>(A_1005) where these certificates were stored 
    2. On containment stage, when you found an <[account]>(A_1001) that was attacked go to [compromised active directory account](/response_playbooks/RP_0009_compromised_active_directory_account/entity) response playbook
    3. On containment stage, when you found the <[host]>(A_1005) where these certificates were stored go to [windows host compromised](/response_playbooks/RP_0008_windows_host_compromise/entity) response playbook
    4. On eradication stage need **revoke all <[certificates]>(A_1011)** that were stored on the <[host]>(A_1005)
    5. On recovery stage, reissue revoked previously <[certificate]>(A_1011)
    6. Save all <[timestamps]> of implemented actions in Incident Report draft on the fly, it will save a lot of time
  
    ## Response discovery mapping

    | ARTIFACT                                       | RESPONSE ACTION                                                                                                  | RESPONSE ACTION OBSERVABLES                                                                        |
    | :----------------------------------------------| :----------------------------------------------------------------------------------------------------------------| :-------------------------------------------------------------------------------------------------|
    | <[Certificate]>(A_1011) | Find .pfx and .der files on compromised host | Thefted certificates |
  
