title: Kerberos password spraying
description: Response playbook for "Kerberos password spraying" attack
id: RP0012
author: '@ERMACK_COMMUNITY'
creation_date: 2023/07/22
modification_date: 2023/07/23
linked_artifacts:
  - A1001
  - A1007
  - A1008
tags:
  - status.stable
  - severity.high
  - tlp.amber
  - pap.white
  - kerberos
preparation:
  - RP_1001_operational_preparations
  - RA_1102_access_internal_network_flow_logs
  - RA_1109_access_internal_packet_capture_data
  - RA_1112_get_ability_to_block_internal_ip_address
  - RA_1120_get_ability_to_block_user_internal_communication
identification:
  - RA_2004_find_compromised_host
  - RA_2601_list_users_authenticated
  - RA_2604_find_compromised_user
  - RA_2003_put_compromised_accounts_on_monitoring
containment:
  - RP_0008_windows_host_compromise
  - RP_0009_compromised_active_directory_account
#eradication:
#recovery:
lessons_learned:
  - RA_6001_develop_incident_report
  - RA_6002_conduct_lessons_learned_exercise
  - RA_6006_update_password_policy

extended_description: |
  A password spray attack is quite simple, and if successful, has serious consequences, because attackers obtain the credentials of one or more users, which widens their attack surface
workflow: |
  <img src="../RP0012.png" alt="workflow" />
  
  To successfully respond to a password spray attack, network logs of access to the domain controller are needed. 
  With the help of these logs, we will find the IP address from which the attack was carried out and the list of users whose credentials were picked up.
  
  Signs that a password spray attack is being carried out from this IP address:
  
  1. A large number of failed authentication requests with different usernames
  2. Authentication requests with usernames for which this IP address is not typical
  
  The picture below shows a lot of authentication requests (AS_REQ Kerberos message) to the domain controller (192.168.10.1) from the IP address 192.168.10.10
  
  <img src="../traffic_spray.png" alt="Traffic" />
  
  The above traffic dump also shows that one of the users got a password. This is evidenced by the AS_REP response of the domain controller. 
  In the response, you can find the username whose credentials were obtained by the attackers. The picture below shows the response of the domain controller, which contains the username
  
  <img src="../as_rep.png" alt="AS_REP" />
  
  After successful authentication on the domain controller, an <[event with ID 4768]>(A_1008) will be generated, which will also contain the username and IP address.
  
  <img src="../Event4768.png" alt="Event" />
  
  After we have found the names of the compromised users and the IP address from which this attack was carried out, proceed to [Compromised active directory account response playbook](/response_playbooks/RP_0009_compromised_active_directory_account/entity) and [Windows host compromise response playbook](/response_playbooks/RP_0008_windows_host_compromise/entity) 
  
  On lessons learned stage need to check that users do not have commonly used passwords and update the password policy.
  
  ## Response discovery mapping
  
  | ARTIFACT  | RESPONSE ACTION    | RESPONSE ACTION OBSERVABLES  |
  | :---------------------------| :---------------------------| :---------------------------|
  | [Domain account](/artifacts/A_1001_windows_domain_account/entity/) | [Find compromised user](#identification) <br> *Find the username for which the domain controller returned AS_REP and for which <[event ID 4768]>(A_1008) was generated* | Name or names of the users whose credentials were obtained by the attackers |
  | [IP Address](/artifacts/A_1007_ip_address/entity/) | [Find compromised host](#identification) <br> *Find an IP address with a lot of failed authentications or authentication requests with atypical usernames for this address* | IP address from which the attack was carried out |