title: 'Remote code execution in Bitrix using vote or fileman modules'
id: UC0007
author: '@ERMACK_COMMUNITY'
creation_date: 2023/07/09
modification_date: 2023/07/09
severity: H
tags:
  - attack.initial_access
  - attack.t1190
  - bitrix
linked_response_playbooks:
  - RP0011
linked_artifacts:
  - A1008
  - A2001
  - A2002
  - A2003
  - A3002
description: Attackers can use vulnerabilities in modules vote or fileman in Bitrix CMS to remote code execution
extended_description: |
  For remote code execution attackers can exploiting vulnerabilities in modules **vote** or **fileman** in Bitrix CMS
  
  ### Vote module
  Insufficient validation of user input in vote module Bitrix CMS allow attackers to arbitrary object instantiation which leads to arbitrary file write and remote code execution.
  To exploit this vulnerability, attackers form a special POST request to the endpoint */bitrix/tools/vote/uf.php*
  This vulnerability exist in the vote module Bitrix site manager up to version 22.0.400 of all editions except start.
  This vulnerability has been assigned an identifier CVE-2022-27228.
  
  ### Fileman module
  Vulnerability in fileman module Bitrix CMS allow attackers to arbitrary file write which leads to remote code execution.
  To exploit this vulnerability, attackers form a special POST request to the endpoint */bitrix/tools/html_editor_action.php*
  File that the attackers upload to the server will be located in folder upload/, in which file execution is usually prohibited.
  To bypass this restriction attackers can upload a file with .phar extension and run successfully on debian-like distributions.
  
  ## Attack mapping 

  | ARTIFACT | OBJECT | DESCRIPTION |
  | :--------| :------| :-----------|
  | **Attack Prerequisites**        |
  | <[Web application server]>(A_2001)     | Bitrix CMS | Bitrix site manager up to version 22.0.400 of all editions except start with installed modules fileman or vote |
  | <[Web server]>(A_2002) | Apache in most cases | Web server hosting Bitrix CMS |
  | <[Web script file]>(A_2003) | Php file | Php file with vulnerable code executing on the server side |
  | **Side Observables**            |
  | <[Log]>(A_1008) | Web server request logs | Logs of requests to the web server with attempts to exploit the vulnerability |
  | <[File]>(A_3002) | Web shell file | File with .php or .phar extension which attackers uploaded on server for command execution |

  ## Attack result

  The result of this attack is a code execution on <[web server]>(A_2002). Most often, attackers upload a web shell to execute commands on the server. 

  | RESOURCE | DESCRIPTION | 
  | :--------| :-----------|
  | **Attack Prerequisites** |
  | <[Web server]>(A_2002)     | Web server network availability  |
  | <[Web script file]>(A_2003) | Script file with vulnerable code |
  | **Result Consequences** |
  | <[File]>(A_3002) | Web shell that allows attackers to execute commands on a web server |

  ## References
  1. <https://www.cyberok.ru/docs/CyberOK-Bitrix_web_1.1.pdf>
  2. <https://github.com/cr1f/writeups/blob/main/attacking_bitrix.pdf>
