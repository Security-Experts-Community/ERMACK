title: 'Successfull Kerberos password spraying'
id: UC0008
author: '@ERMACK_COMMUNITY'
creation_date: 2023/07/21
modification_date: 2023/07/21
severity: M
tags:
  - attack.credential_access
  - attack.t1110.003
  - kerberos
linked_response_playbooks:
  - RP0012
linked_artifacts:
  - A1001
  - A1010
  - A1008
  - A1009
  - A5008
description: Attackers can carry out a password spray attack to obtain valid credentials
extended_description: |
  Attackers may use single or small list of commonly used passwords against many different accounts to attempt to acquire valid account credentials. 
  Logins are attempted with that passwords list against many different accounts on a network to avoid account lockouts that would normally occur when brute forcing a single account with many passwords.
  
  ## Attack mapping 
  | ARTIFACT | OBJECT | DESCRIPTION |
  | :--------| :------| :-----------|
  | **Attack Prerequisites**        |
  | <[Active Directory Account]>(A_1001) | Domain users names | List of valid domain users names |
  | <[Authentication Service]>(A_1010) | Authentication service on domain controller | Network availability to authentication service on domain controller |
  | **Side Observables**            |
  | <[Log]>(A_1008) | Windows security log | Windows security log with EventID 4768 - A Kerberos authentication ticket (TGT) was requested |
  | <[Kerberos network traffic]>(A_1009)    | Kerberos protocol messages | Kerberos protocol messages which generated during the attack |
  
  The list of valid usernames is included in the prerequisites, but many utilities (as will be shown) can determine whether a given user exists in the domain and display an appropriate message about it.
  Accordingly, in the general case, the list of valid users is not a prerequisite for this attack.
  However, the list of valid usernames is specified in the prerequisites, since getting this list is a [separate attack](/usecases/UC_0002_as_req_domain_user_enumerate/entity).
  
  ## Attack result
  The result of this attack is the credentials of one or more users
  
  | RESOURCE | DESCRIPTION | 
  | :--------| :-----------|
  | **Attack Prerequisites** |
  | <[Active Directory Account]>(A_1001) | List of valid domain users names  |
  | <[Authentication Service]>(A_1010) | Network availability to authentication service on domain controller |
  | **Result Consequences** |
  | <[Password]>(A_5008) | Valid password of one or more users |
  
  ## Attack progress
  
  Attackers sequentially send authentication requests with a given password to different users. Depending on the response of the authentication service, a conclusion is made about the correctness of the password.
  If successful, the authentication service will return AS_REP kerberos message.
  <img src="../traffic_spray.png" alt="Traffic">
  
  After successful authentication on the domain controller, event 4768 will be generated.
  <img src="../Event4768.png" alt="Event">
  
  Below are the tools that can be used to carry out this attack
  
  ### Rubeus
  
  ```
  Rubeus brute /password:<password> /users:<users_list>
  ```
  <img src="../rubeus_brute.png" alt="Rubeus">
  
  ### Kerbrute
  
  ```
  kerbrute_linux_amd64 passwordspray -d <domain> <users_list> <password>
  ```
  <img src="../kerbrute_spray.png" alt="Kerbrute">
  
  ## References
  1. <https://ardent101.github.io/posts/kerberos_general_attacks/>
  2. <https://github.com/GhostPack/Rubeus>
  3. <https://github.com/ropnop/kerbrute>