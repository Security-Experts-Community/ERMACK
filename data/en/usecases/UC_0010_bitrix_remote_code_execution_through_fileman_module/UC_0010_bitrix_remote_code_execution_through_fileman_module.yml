title: 'Remote code execution in Bitrix using fileman module'
id: UC0010
author: '@ERMACK_COMMUNITY'
creation_date: 2023/08/08
modification_date: 2023/08/08
severity: H
tags:
  - attack.initial_access
  - attack.t1190
  - bitrix
linked_response_playbooks:
  - RP0011
linked_artifacts:
  - A1008
  - A2001
  - A2002
  - A2003
#targets:
#  - ID: S3004
#    cpe_from: 'cpe:2.3:a:bitrix:bitrix:-:*:*:*:*:*:*:*'
#    cpe_to: 'cpe:2.3:a:bitrix:bitrix:-:*:*:*:*:*:*:*'
#  - ID: S0100
#    cpe_from: 'cpe:2.3:o:debian:debian_linux:-:*:*:*:*:*:*:*'
#    cpe_to: 'cpe:2.3:o:debian:debian_linux:-:*:*:*:*:*:*:*'

description: Attackers can use vulnerabilities in fileman module in Bitrix CMS to remote code execution
extended_description: |
  
  Vulnerability in fileman module Bitrix CMS allow attackers to arbitrary file write. 
  To exploit this vulnerability, attackers form a special POST request to the endpoint */bitrix/tools/html_editor_action.php*
  To be able to remotely execute code on a web server, attackers upload a web script file that can execute their commands.
  File that the attackers upload to the server will be located in folder upload/, in which file execution is usually prohibited.
  To bypass this restriction attackers can upload a file with .phar extension and run successfully on debian-like distributions.
  
  An example of an entry in the web server logs indicating that this vulnerability was successfully exploited:
  
  ```
  POST /bitrix/tools/html_editor_action.php HTTP/1.0" 200
  ```
  
  ## Attack mapping
  
  | ARTIFACT/RESOURCE | DESCRIPTION |
  | :-----------------| :-----------|
  | **Attack Prerequisites** |
  | <[Bitrix]>(A_2001) network available | Network availability of CMS Bitrix |
  | <[Web server]>(A_2002) | Web server on debian like distribution |
  | **Attack Consequences** |
  | Remote code execution on <[Web server]>(A_2002) | Possibility of remote code execution on the web server hosting Bitrix |
  | **Side Observables** |
  | <[Log]>(A_1008) | Log entry about a successful POST request to a vulnerable */bitrix/tools/html_editor_action.php* <[file]>(A_2003) |
  | <[Web script file]>(A_2003) | Web script file in the download folder/ with which attackers execute commands on the web server |
  
  ## References
  1. <https://www.cyberok.ru/docs/CyberOK-Bitrix_web_1.1.pdf>
  2. <https://github.com/cr1f/writeups/blob/main/attacking_bitrix.pdf>