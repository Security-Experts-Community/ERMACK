title: Анализ пользовательского агента
id: RA2117
stage: RS0002
brief: Проанализируйте заголовок запроса пользовательского агента на наличие признаков подозрительной активности
authors: Patrick Abraham
creation_date: 11/12/2020
modification_date: 25/09/2023
requirements: []
resources:
  prerequisites: []
  results:
    main: []
    side: []
description: |
  Строка User-Agent представляет собой часть метаданных, связанных с заголовком HTTP-запроса, 
  и используется для согласования содержимого, как описано в [RFC1945](https://tools.ietf.org/html/rfc1945#page-46). 
  Пользовательские агенты часто могут быть упущены вниманием злоумышленниками и, таким образом, предоставляют ценную отправную точку для исследования.
  
  1. Извлеките пользовательский агент из заголовка HTTP.
  2. Используя нижеприведенную методологию в качестве справки, сделайте вывод о том, является ли предоставленный пользовательский агент подозрительным или нет.
  
  **Признаки подозрительных пользовательских агентов на основе анализа строки:**
  
  * Пользовательский агент остается пустым.
  * Пользовательский агент содержит опечатки или отклонения в написании, отличные от известных хороших примеров пользовательских агентов.
  * Пользовательский агент содержит последовательность случайных символов или "белиберду", подобную той, которая находится в MITRE ATT&CK [T1568.002](https://attack.mitre.org/techniques/T1568/002/).
  * Пользовательский агент содержит код, который может выполнить атаку типа XSS или SQL Injection.
  
  **Признаки подозрительных пользовательских агентов на основе репутационного анализа:**
  
  * Пользовательский агент не указан как популярный пользовательский агент в справочных материалах, таких как [WhatIsMyBrowser](https://developers.whatismybrowser.com/useragents/explore/).
  * Следует отметить, что есть ценность во взаимодействии с сообществом по конкретным пользовательским агентам, и это часто можно сделать, используя поисковую систему, такую как Google.
  
  **Освежите ваши результаты с помощью информации из вашего окружения.**
  
  * Рассмотрите, соответствует ли пользовательский агент вашему окружению. Например, наличие пользовательских агентов Mac OS X в среде, предназначенной только для Windows.
  * Рассмотрите возможность проведения долгосрочного анализа или кластеризации для выявления аномалий в вашей среде.
  
  ### Важные соображения
  * Пользовательские агенты генерируются на стороне клиента и могут быть легко поддельными. Многие злоумышленники часто используют известные хорошие пользовательские агенты, чтобы скрыть свою активность.
  * Анализ пользовательского агента должен сочетаться с другими анализами для увеличения точности сигнала. Хорошо известно, что множество легитимных приложений (особенно пользовательских) могут опускать строки пользовательского агента или использовать значения по умолчанию, связанные с популярными библиотеками.
references:
  - https://www.sans.org/reading-room/whitepapers/malicious/user-agent-field-analyzing-detecting-abnormal-malicious-organization-33874
  - https://www.cybersecurity-insiders.com/threat-hunting-for-http-user-agents/
  - https://isc.sans.edu/forums/diary/Capture+and+Analysis+of+User+Agents/23705/
  - https://deviceatlas.com/blog/user-agent-parsing-how-it-works-and-how-it-can-be-used
