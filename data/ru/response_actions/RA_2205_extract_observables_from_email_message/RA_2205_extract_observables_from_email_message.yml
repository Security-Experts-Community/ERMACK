title: Извлечь необходимые сведения из письма электронной почты
id: RA2205
description: Извлечь необходимые сведения из письма электронной почты
author: enikulina
creation_date: 2022/02/02
stage: identification
automation:
  - thehive
  - ptnad
references:
  - https://ubuntuincident.wordpress.com/2010/09/27/extract-email-attachments/
  - https://support.office.com/en-ie/article/view-internet-message-headers-in-outlook-cd039382-dc6e-4264-ac74-c048563d212c#:~:text=View%20message%20headers%20in%20Outlook,in%20the%20Internet%20headers%20box
  - https://www.lifewire.com/view-full-message-headers-thunderbird-1173106
  - https://toolbox.googleapps.com/apps/messageheader/
  - https://blog.thehive-project.org/2018/07/31/emlparser-a-new-cortex-analyzer-for-eml-files/
extended_description: |
  Извлечь из заголовков и тела письма все сведения, которые будут необходимы для дальнейшего анализа и реагирования на иницидент:

  - тему письма;
  - данные из заголовка письма "From:" (содержит обратный адрес и домен, отображаемый получателю в письме);
  - данные из заголовка письма "Reply-To:" (содержит обратный адрес, указанный отправителем для отправки ответного письма);
  - данные из технического заголовка "Return-Path:"/"Envelope-From" (содержит обратный адрес, указанный отправителем в конвертном заголовке, используется для отправки недоставленных писем и для авторизации SPF);
  - данные из технических заголовков "Received:" (содержат сведения обо всех почтовых серверах, через которые прошло письмо; первый снизу содержит почтовый сервер, с которого было отправлено письмо, и реальный IP-адрес отправителя - однако, при отправке письма через веб-сервисы электронный почты реальный IP будет отображен в других заголовках или не отображен вообще);
  - данные из заголовка безопасности "Received-SPF:" (содержит информацию о проверке соответствия домена отправителя его IP-адресу, результат проверки представлен значениями "Fail"/"Pass"/"Softfail"/"Neutral");
  - данные из заголовка безопасности "DKIM-Signature" (содержит цифровую подпись, составленную на основе закрытого ключа шифрования, тела письма, его заголовков, текущего времени, и других параметров);
  - данные из заголовка безопасности "Authentication-Results:" (содержит сведения о результатах проверок подлинности SPF, DKIM и DMARC);
  - данные из кастомных заголовков формата "X-..:" (опционально добавляются провайдерами электронной почты и могут содержать полезную информацию, например, реальный IP отправителя в часто добавляемом почтовыми веб-сервисами "X-Originating-IP" или использованный отправителем почтовый клиент в "X-Mailer:")
  - вложения (имена файлов, хеши файлов);
  - URL\IP-адреса в теле письма.
  
  Это действие может быть автоматизировано с помощью специализированных онлайн-сервисов, СЗИ и [TheHive EmlParser](https://blog.thehive-project.org/2018/07/31/emlparser-a-new-cortex-analyzer-for-eml-files/).
