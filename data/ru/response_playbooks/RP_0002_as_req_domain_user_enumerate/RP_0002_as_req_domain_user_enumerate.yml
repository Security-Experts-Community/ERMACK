title: Атака перечислением с использование протокола Kerberos без учетной записи в домене
description: Сценарий реагирования на атаку перечислением с использование протокола Kerberos без учетной записи в домене
id: RP0002
author: '@ERMACK_COMMUNITY'
creation_date: 2023/03/12
modification_date: 2023/03/12
linked_artifacts:
  - A1001
  - A1005
  - A1007
  - A1009
preparation:
  - RP_1001_operational_preparations
  - RA_1102_access_internal_network_flow_logs
  - RA_1109_access_internal_packet_capture_data
  - RA_1112_get_ability_to_block_internal_ip_address
  - RA_1116_get_ability_to_block_internal_url
  - RA_1120_get_ability_to_block_user_internal_communication
  - RA_1121_get_ability_to_find_data_transferred_by_content_pattern
  - RA_1123_get_ability_to_list_data_transferred
  - RA_1124_get_ability_to_collect_transferred_data
  - RA_1125_get_ability_to_identify_transferred_data
identification:
  - RA_2004_find_compromised_host
  - RA_2603_find_success_enumed_users
  - RA_2003_put_compromised_accounts_on_monitoring
containment:
  - RP_1005_compromised_host
#eradication:
#recovery:
lessons_learned:
  - RA_6001_develop_incident_report
  - RA_6002_conduct_lessons_learned_exercise
extended_description: |
  | Artifact                                | Response action                                                                                                                                                                                                      | Possible discovered entity                                                                                                   |
  | :-------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| :--------------------------------------------------------------------------------------------------------------------------  |
  | <[Domain account]>(A_1001) username     | Найдите аккаунты пользователий обнаруженные атакой. Проверьте, не были ли они скомпроментированы                                                                                                                     | Аккаунты, на который сервисом аутентификации было отправлено сообщение KDC_ERR_PREAUTH_REQUIRED                              |
  | <[Host]>(A_1005)                        | Если обнаружились хосты с подозрительной активностью, перейдите к сценарию <[Compromised Host]>                                                                                                                      | Следы инструментов для атаки, либо подозрительный внешний траффик                                                            |
  | <[IP Address]>(A_1007)                  | Если обнаружились IP адреса с подозрительной активностью, перейдите к сценарию <[Compromised Host]>                                                                                                                  | Неавторизованные сообщения KRB_AS_REQ, нетипичные имена пользователей для IP адресов, либо несуществующие имена пользователей|
  | <[Kerberos network traffic]>(A_1009)    | При обнаружении большого числа сообщений типа KRB_AS_REQ без предварительной аутентификации, или сообщений KDC_ERR_C_PRINCIPAL_UNKNOWN найдите хост, который их отправлял и перейдите к сценарию <[Compromised Host]>| Неавторизованные сообщения KRB_AS_REQ в большом числе, и сообщения типа KDC_ERR_C_PRINCIPAL_UNKNOWN messages                 |

workflow: |
    1. На стадии identification надо обнаружить <[host or hosts]>(A_1005) с которых происходила атака. Это могут быть хосты с подозрительными соединениями во внешнюю сеть, либо какие либо следы атаки (например инструментарий атакующего и следы его работы). Например, это может быть <[IP Addreses]>(A_1007) с большим числом сообщений KRB_AS_REQ без предварительной аутентификации и с нетепичных для этого IP адреса имен, либо вовсе - несуществующих имен
    2. O На стадии identification надо обнаружить <[domain account]>(A_1001) логичны, которые злоумшленнику удалось обнаружить. Это логины, которым сервис авторизации отправил сообщение KDC_ERR_PREAUTH_REQUIRED
    3. После выяснения обнаруженных злоумышленником аккаунтов, следует уделить пристальное внимание их мониторингу, поискать следы проникновения
    4. После обнаружения скомпроментированных хостов - перейти к сценарию реагирования <[Compromised Host]>
    5. Сохраните все <[timestamps]> обнаруженных вами подозрительных действий, отразите ваши действия в отчете, это поможет в будущем
