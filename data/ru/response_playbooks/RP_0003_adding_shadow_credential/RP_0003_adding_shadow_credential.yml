title: Добавление скрытых учетных данных для входа
description: Сценарий реагирования на добавление скрытых учетных данных, через изменение атрибута msDS-KeyCredentialLink
id: RP0003
author: '@ERMACK_COMMUNITY'
creation_date: 2023/05/07
modification_date: 2023/05/07
linked_artifacts:
  - A1001
  - A1008
  - A1015
preparation:
  - RP_1001_operational_preparations
  - RA_1602_get_ability_to_lock_user_account
identification:
  - RA_2604_find_compromised_user
  - RA_2003_put_compromised_accounts_on_monitoring
containment:
  - RA_3601_lock_user_account
  - RP_1006_compromised_user
eradication:
  - RA_4604_delete_attribute_from_object
recovery:
  - RA_5601_unlock_locked_user_account
lessons_learned:
  - RA_6001_develop_incident_report
  - RA_6002_conduct_lessons_learned_exercise

extended_description: |
  | Artifact                                       | Response action                                                                                                                        | Possible discovered entity                                                                              |
  | :----------------------------------------------| :--------------------------------------------------------------------------------------------------------------------------------------| :-------------------------------------------------------------------------------------------------------|
  | <[Domain account]>(A_1001)                     | Найдите аккаунт, на котором был изменен атрибут msDS-KeyCredentialLink, заблокируйте аккаунт, удалите атрибут, разблокируйте аккаунт   | В случае настроенного журналирования, скомпроментированный аккаунт будет в секции object в event log    |
  | <[Log]>(A_1008)                                | В службе event log найдите лог Windows Security с ID 5136 - Directory service object was modified                                      | В случае настроенного журналирования изменения атрибута, вы также найдете лог с событием                |
  | <[Domain account]>(A_1001)                     | Найдите аккаунт, с которого была совершена атака                                                                                       | В случае настроенного журналирования, можно найти событие в журнале event log: subject section          |
  | <[Directory service object attribure]>(A_1015) | Удалить добавленный в аккаунт атрибут msDS-KeyCredentialLink                                                                           | В случае настроенного журналирования, можно найти событие в журнале event log: subject section          |

workflow: |
    1. На стадии identification вам необходимо найти <[domain accounts]>(A_1001), который был атакован, и с которого была совершена атака. Эта информация может быть получена из <[Windows Security event log]>(A_1008) 5136 - Directory service object was modified
    2. На стадии containment, после обнаружения <[account]>(A_1001) с которого совершалась атака, перейдите к сценарию реагирования <[Compromised user]> 
    3. На стадии containment, после обнаружения <[account]>(A_1001) который был атакован, заблокируйте аккаунт
    4. На стадии eradication, удалите <[msDS-KeyCredentialLink attribute]>(A_1015) с атакованного аккаунта
    5. На стадии recovery, разблокируйте ранее заблокированный аккаунт
    6. Сохраните все <[timestamps]> совершенных действий и обнаруженных событий, составьте отчет, это поможет в будущем
