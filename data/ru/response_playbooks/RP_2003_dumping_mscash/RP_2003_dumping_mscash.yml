title: Дамп mscash
id: RP2003
author: '@Cyberok'
creation_date: 2023/02/03
modification_date: 2023/04/23
linked_artifacts:
  - A1005
  - A3002
  - A5002
  - A5005
  - A5008
tags:
  - status.stable
  - severity.high
  - tlp.amber
  - pap.white
  - windows
preparation:
  - RP_1001_operational_preparations
identification:
  - RA_2301_list_files_created
  - RA_2302_list_files_modified
  - RA_2304_list_files_downloaded
  - RA_2401_list_processes_executed
  - RA_2406_find_process_by_executable_content_pattern
  - RA_2503_list_registry_keys_accessed
  - RP_1003_identify_compromised_data
  - RP_1004_identify_means_of_attack
containment:
  - RA_3405_block_process_by_executable_content_pattern
  - RA_3601_lock_user_account
eradication:
  - RA_4603_reset_authentication_credentials
  - RA_4601_revoke_authentication_credentials
recovery:
  - RA_5601_unlock_locked_user_account
lessons_learned:
  - RA_6001_develop_incident_report
  - RA_6002_conduct_lessons_learned_exercise

description: Сценарий реагирования на активность связанную с дампом MScash.
extended_description: |
   Атакующие могут считать хэш суммы учетных данных для входа в систему посредством дампа MScash. Эти хэши могут быть послужить для брутфорса учетных данных или использованы для продвижения по инфраструктуре сети 
   
   Добытые в процессе учетные данные не могут быть использованы в атаке pass-the-hash, так что атакующему в любом случае необходим брутфорсить пароли по хэш сумме.
workflow: |
    *Для более эффективного выявления и реагирования на инциденты необходимо идентифицировать необычные события в процессе*

    1. Определите обнаруженные IOCs (Свидетельство компроментации системы: програмы, инструменты злоумышленника, использованные команды в консоли) использованные для получения учетных данных, это поможет найти подозритеотные события. Просмотрите созданные/измененные/загруженные файлы и поищите процесс, запущенные со "специфичными" атрибутами. Например:

        - процессы запущенные с аргемнтами:(ShadowHashData или "-dump")
        - процессы, обращающиеся к разделам регистра *hklm\sam hklm\system hklm\security*
        - процессы, с часто применяемыми злоумышленниками параметрами (*privilege::debug, token::elevate, lsadump::cache*)

    2. Как уже сказано, полученные данные не используемые для атаки Pass-the-Hash, следовательно, скорее всего злоумышленник загрузит файл с дампами на свою машину. Просмотрите созданные/измененные/загруженные файлы для идентификации источника атаки (ip, host, etc...).
    3. Примите меры по ограничению в зависимости от ситуации и важности ресурса. Например, если у вас есть подозрения на повышение привелегий, заблокируйте подозрительного пользователя или процесс посредством автоматических сценариев блокировки:
        - Заблокируйте процесс по патернам поведения
        - Заблокируйте аккаунт пользователя
    4. Примите меры по ликвидации в зависимости от ситуации и важности ресурса. Например, учетные данные могут быть использованы как аргумент для вредоносной команды:
        - Отзовите учетные данные для входа
    5. В зависимости от действий по ликвидации и ограничению, совершите действия по восстановлению:
        - Разблокируйте заблокированного пользователя (если необходимо)
        - Смените учетные данные пользователей
    6. Сообщите об инциденте, устраните последствия нарушения, извлеките уроки.

    ## Response discovery mapping

    | ARTIFACT                  | RESPONSE ACTION                                                                                | RESPONSE ACTION OBSERVABLES                                                    |
    | ------------------------- | ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------ |
    | [Windows Registry](/artifacts/A_5002_windows_registry/entity)                   | [Список использованных ключей реестра]() <br> *Искать команды сохранение реестра*                | Попытка сбора учетных данных |
    | [Process](/artifacts/A_4001_process/entity) | [Поиск процесса по патерну]() <br>*Ищите необычные события, свидетельствующие о применении хакерского инструментария* | Обнаружен инструмент сбора учетных данных |
    | [Encrypted Credential](A_5005_encrypted_credential/entity/) | [Изучение событий]() <br>*Определить, какие учетные данные пользователей были собраны, это зависит от того, сколько учетных данных пользователей было кэшировано хосте.* | Список потенциально скомпрометированных пользователей |
    | [Password](/artifacts/A_5008_password/entity/) | [Отозвать учетные данные для авторизации]() <br>[Обнулить пароль]() <br>*Зависит от котекста.* | Скомпроментированный/Новый пароль |


    *P.S. Артефакты из "Attack Prerequisites" ( в данном случе : [Host]() и [File]() ) должны быть использованы в [Operational Preparations]() и в качестве аргументов для других входных действий, например:*
    <details>
    <summary><b>response action: list processes executed</b></summary>
    ```
    List_processes_executed (enabled=True, host)
    ```
    </details>

    ## Response mindmap diagram
    <img src="../03.svg" alt="Mindmap"/>
